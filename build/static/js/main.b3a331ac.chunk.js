(this["webpackJsonpchat-client"]=this["webpackJsonpchat-client"]||[]).push([[0],{452:function(e,n,t){e.exports=t(894)},889:function(e,n,t){},894:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(68),o=t.n(c),i=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function l(e,n){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;null!=t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(e)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var s=t(198),u=t(43),d=t(200),m=t(201),p=t(199),b=t(418),g=t(422),f=(t(457),t(100)),h=t(916),v=t(9),O=new(t(167).SubscriptionClient)("ws://dc-itc.el.vgtu.lt:22080/stud-18-backend/graphql",{reconnect:!0,lazy:!0,connectionParams:function(){var e=localStorage.getItem("current-user");return e?(e=JSON.parse(e),console.log("connected"),{authorization:e.token}):null}}),y=Object(a.createContext)({user:null,onLogout:function(){},onLogin:function(){},loading:!0}),j=function(e){var n=e.children,t=Object(a.useState)(null),c=Object(v.a)(t,2),o=c[0],i=c[1],l=Object(a.useState)(!0),s=Object(v.a)(l,2),u=s[0],d=s[1];Object(a.useEffect)((function(){var e=localStorage.getItem("current-user");e&&i(JSON.parse(e)),d(!1)}),[]);var m={user:o,onLogout:function(){console.log("remove connection"),O.unsubscribeAll(),O.close(!0),localStorage.removeItem("current-user"),i(null),d(!1)},onLogin:function(e){localStorage.setItem("current-user",JSON.stringify(e)),i(e),d(!1)},loading:u};return r.a.createElement(y.Provider,{value:m},n)},E=function(e){var n=Object(a.useContext)(y),t=n.user;return n.loading?r.a.createElement(h.a,{vertical:!0,center:!0,content:"loading"}):t?r.a.createElement(f.b,e):r.a.createElement(f.a,{to:"/login"})},C=t(67),k=t(30),S=t(52),w=t(900),N=t(912),x=t(910),I=t(919),B=t(918),T=t(917),L=t(902),R=t(911),U=t(909),$=t(914),A=t(115),F=t(27),q=Object(F.a)({container:{maxWidth:500,margin:"0 auto",marginTop:100}}),M=t(420),W=t(17),P=t(13);function G(){var e=Object(W.a)(["\n    mutation login($data: LoginInput!) {\n        login(data: $data) {\n            user {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            token\n        }\n    }\n"]);return G=function(){return e},e}var Q=Object(P.a)(G());function z(){var e=Object(W.a)(["\n    mutation register($data: RegisterInput!) {\n        register(data: $data) {\n            user {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            token\n        }\n    }\n"]);return z=function(){return e},e}var H=Object(P.a)(z());function D(){var e=Object(W.a)(["\n    mutation sendMessage($data: MessageInput!, $image: Upload) {\n        sendMessage(data: $data, image: $image) {\n            id\n            sender {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            content\n            createdAt\n            updatedAt\n            replyCount\n            imageUrl\n            type\n            pinned\n        }\n    }\n"]);return D=function(){return e},e}var J=Object(P.a)(D());function K(){var e=Object(W.a)(["\n    mutation initConversation($members: [String!]!) {\n        initConversation(members: $members) {\n            id\n            type\n            starred\n            createdAt\n            members {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n        }\n    }\n"]);return K=function(){return e},e}var Y=Object(P.a)(K());function V(){var e=Object(W.a)(["\n    mutation toggleStar($id: String!) {\n        toggleStar(id: $id) {\n            id\n            type\n            starred\n            createdAt\n            members {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n        }\n    }\n"]);return V=function(){return e},e}var X,Z=Object(P.a)(V()),_=function(){var e=Object(a.useState)([]),n=Object(v.a)(e,2),t=n[0],c=n[1],o=Object(a.useState)({email:"",password:"",displayName:""}),i=Object(v.a)(o,2),l=i[0],s=i[1],u=q(),d=Object(f.g)(),m=Object(M.a)(H,{onCompleted:function(){d.push("/login")},onError:function(e){var n=e.graphQLErrors;c(n)}}),p=Object(v.a)(m,2),b=p[0],g=p[1].loading;function h(e){return function(n){s(Object(S.a)({},l,Object(k.a)({},e,n)))}}return r.a.createElement(w.a,{className:u.container},r.a.createElement(N.a,null,r.a.createElement(x.a,{justify:"center"},r.a.createElement(x.a.Item,{componentClass:I.a,xs:24},r.a.createElement(B.a,{header:r.a.createElement("h3",null,"Register"),bordered:!0},r.a.createElement(T.a,{fluid:!0},r.a.createElement(L.a,null,t.map((function(e,n){return r.a.createElement(R.a,{key:"error-".concat(n),showIcon:!0,type:"error",description:e.message})}))),r.a.createElement(L.a,null,r.a.createElement(U.a,{name:"name",placeholder:"Display name",onChange:h("displayName"),value:l.displayName})),r.a.createElement(L.a,null,r.a.createElement(U.a,{name:"email",placeholder:"Email address",onChange:h("email"),value:l.email})),r.a.createElement(L.a,null,r.a.createElement(U.a,{name:"password",type:"password",placeholder:"Password",onChange:h("password"),value:l.password})),r.a.createElement(L.a,null,r.a.createElement($.a,null,r.a.createElement(A.a,{appearance:"primary",loading:g,onClick:function(){c([]),b({variables:{data:l}})}},"Register"),r.a.createElement(A.a,{appearance:"link",onClick:function(){d.push("/login")}},"Sign in")))))))))},ee=Object(F.a)({container:{maxWidth:500,margin:"0 auto",marginTop:100}}),ne=function(){var e=Object(a.useState)([]),n=Object(v.a)(e,2),t=n[0],c=n[1],o=Object(a.useState)({email:"",password:""}),i=Object(v.a)(o,2),l=i[0],s=i[1],u=ee(),d=Object(f.g)(),m=Object(a.useContext)(y).onLogin,p=Object(M.a)(Q,{onCompleted:function(e){var n=e.login;m(Object(S.a)({},n.user,{token:n.token})),d.push("/")},onError:function(e){var n=e.graphQLErrors;c(n)}}),b=Object(v.a)(p,2),g=b[0],h=b[1].loading;function O(e){return function(n){s(Object(S.a)({},l,Object(k.a)({},e,n)))}}return r.a.createElement(w.a,{className:u.container},r.a.createElement(N.a,null,r.a.createElement(x.a,{justify:"center"},r.a.createElement(x.a.Item,{componentClass:I.a,xs:24},r.a.createElement(B.a,{header:r.a.createElement("h3",null,"Login"),bordered:!0},r.a.createElement(T.a,{fluid:!0},r.a.createElement(L.a,null,t.map((function(e,n){return r.a.createElement(R.a,{key:"error-".concat(n),showIcon:!0,type:"error",description:e.message})}))),r.a.createElement(L.a,null,r.a.createElement(U.a,{name:"email",placeholder:"Email address",onChange:O("email"),value:l.email})),r.a.createElement(L.a,null,r.a.createElement(U.a,{name:"password",type:"password",placeholder:"Password",onChange:O("password"),value:l.password})),r.a.createElement(L.a,null,r.a.createElement($.a,null,r.a.createElement(A.a,{appearance:"primary",loading:h,onClick:function(){c([]),g({variables:{data:l}})}},"Sign in"),r.a.createElement(A.a,{appearance:"link",onClick:function(){d.push("/register")}},"Register")))))))))},te=t(915),ae=t(904),re=t(141),ce=t(908),oe=t(21),ie=t.n(oe),le=t(41),se=t(906),ue=t(905),de=r.a.memo((function(e){var n=e.open,t=e.handleClose,c=e.users,o=e.refetch,i=Object(a.useState)([]),l=Object(v.a)(i,2),s=l[0],u=l[1],d=Object(a.useState)([]),m=Object(v.a)(d,2),p=m[0],b=m[1],g=Object(M.a)(Y,{onCompleted:function(){o(),t()},onError:function(e){var n=e.graphQLErrors;u(n)}}),f=Object(v.a)(g,2),h=f[0],O=f[1].loading,y=Object(a.useCallback)(Object(le.a)(ie.a.mark((function e(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h({variables:{members:p}});case 2:case"end":return e.stop()}}),e)}))),[p,h]),j=Object(a.useCallback)((function(e){b(e)}),[]),E=c.map((function(e){return{label:e.displayName,value:e.id}}));return r.a.createElement(se.a,{show:n,onHide:t},r.a.createElement(se.a.Header,null,r.a.createElement(se.a.Title,null,"Create a new group")),r.a.createElement(se.a.Body,null,s.map((function(e,n){return r.a.createElement(R.a,{key:"error-".concat(n),showIcon:!0,type:"error",description:e.message})})),r.a.createElement(ue.a,{placeholder:"Add users to group",data:E,onChange:j,value:p,style:{marginTop:10,width:"100%"}})),r.a.createElement(se.a.Footer,null,r.a.createElement(A.a,{onClick:y,disabled:O,appearance:"primary"},"Ok"),r.a.createElement(A.a,{onClick:t,disabled:O,appearance:"subtle"},"Cancel")))})),me=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return e.length>n?e.substring(0,n)+"...":e},pe=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=e.map((function(e){return e.displayName})).join(", ");return n?me(t):t};!function(e){e.Black="#000000",e.White="#FFFFFF",e.LightGrey="#F5F5F5",e.LighterGrey="#EDEDED",e.BorderGrey="#F0F0F0",e.BackgroundGrey="#FBFBFB",e.Grey="#575757",e.Blue="#3498FF"}(X||(X={}));var be=Object(F.a)({container:{height:"100%",borderRight:1,borderRightStyle:"solid",borderRightColor:X.LighterGrey},header:{paddingLeft:20,paddingRight:20,fontSize:16,height:60,display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:1,borderBottomStyle:"solid",borderBottomColor:X.LighterGrey,marginBottom:10}}),ge=t(447);function fe(){var e=Object(W.a)(["\n    mutation initChannel($members: [String!]!, $name: String!) {\n        initChannel(members: $members, name: $name, isPrivate: false) {\n            id\n            type\n            starred\n            createdAt\n            members {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            name\n            isPrivate\n        }\n    }\n"]);return fe=function(){return e},e}var he=Object(P.a)(fe()),ve=r.a.memo((function(e){var n=e.open,t=e.handleClose,c=e.users,o=e.refetch,i=Object(a.useState)([]),l=Object(v.a)(i,2),s=l[0],u=l[1],d=Object(a.useState)({name:"",members:[]}),m=Object(v.a)(d,2),p=m[0],b=m[1],g=Object(M.a)(he,{onCompleted:function(){o(),t()},onError:function(e){var n=e.graphQLErrors;u(n)}}),f=Object(v.a)(g,2),h=f[0],O=f[1].loading,y=Object(a.useCallback)(Object(le.a)(ie.a.mark((function e(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h({variables:{members:p.members,name:p.name}});case 2:case"end":return e.stop()}}),e)}))),[p.members,p.name,h]),j=Object(a.useCallback)((function(e){return function(n){var t=Object(S.a)({},p,Object(k.a)({},e,n));console.log(t),b(t)}}),[p,b]),E=c.map((function(e){return{label:e.displayName,value:e.id}}));return r.a.createElement(se.a,{show:n,onHide:t},r.a.createElement(se.a.Header,null,r.a.createElement(se.a.Title,null,"Create a new group")),r.a.createElement(se.a.Body,null,s.map((function(e,n){return r.a.createElement(R.a,{key:"error-".concat(n),showIcon:!0,type:"error",description:e.message})})),r.a.createElement(ge.a,{onChange:j("name"),value:null===p||void 0===p?void 0:p.name,placeholder:"Channel name",style:{marginBottom:10,marginTop:10}}),r.a.createElement(ue.a,{placeholder:"Add users to channel",data:E,onChange:j("members"),value:p.members,style:{width:"100%"}})),r.a.createElement(se.a.Footer,null,r.a.createElement(A.a,{onClick:y,loading:O,appearance:"primary"},"Ok"),r.a.createElement(A.a,{onClick:t,disabled:O,appearance:"subtle"},"Cancel")))})),Oe=t(419);function ye(){var e=Object(W.a)(["\n    query getUsers {\n        users: getUsers {\n            id\n            email\n            displayName\n            phoneNumber\n            description\n            imageUrl\n        }\n        conversations: getConversations {\n            id\n            type\n            starred\n            createdAt\n            members {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n        }\n        channels: getChannels {\n            id\n            type\n            starred\n            createdAt\n            members {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            name\n            isPrivate\n        }\n    }\n"]);return ye=function(){return e},e}var je=Object(P.a)(ye());function Ee(){var e=Object(W.a)(["\n    query messages($id: String!) {\n        messages(userId: $id) {\n            id\n            sender {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            content\n            createdAt\n            updatedAt\n            replyCount\n            imageUrl\n            type\n            pinned\n        }\n    }\n"]);return Ee=function(){return e},e}var Ce=Object(P.a)(Ee());function ke(){var e=Object(W.a)(["\n    query search($by: String!) {\n        search(by: $by) {\n            users {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            channels {\n                id\n                type\n                starred\n                createdAt\n                members {\n                    id\n                    email\n                    displayName\n                    phoneNumber\n                    description\n                    imageUrl\n                }\n                name\n                isPrivate\n            }\n            conversations {\n                id\n                type\n                starred\n                createdAt\n                members {\n                    id\n                    email\n                    displayName\n                    phoneNumber\n                    description\n                    imageUrl\n                }\n            }\n        }\n    }\n"]);return ke=function(){return e},e}var Se=Object(P.a)(ke()),we=Object(F.a)({panelStyles:{padding:"4px 0px",color:"#aaa"},input:{marginBottom:15},noResults:{padding:"10px 0"}}),Ne=function(e){var n=e.open,t=e.handleClose,c=we(),o=Object(a.useState)(null),i=Object(v.a)(o,2),l=i[0],s=i[1],u=Object(Oe.a)(Se,{skip:null===l,variables:{by:l}}),d=u.loading,m=u.data,p=Object(f.g)(),b=Object(a.useCallback)((function(e,n){return function(){p.push("/".concat(e,"/").concat(n.id)),t()}}),[p,t]),g=Object(a.useMemo)((function(){return d?r.a.createElement(h.a,null):m&&m.search?r.a.createElement(ce.a.Menu,{style:{background:"none"}},r.a.createElement(ce.a.Item,{panel:!0,className:c.panelStyles},"Users"),m.search.users.length>0?m.search.users.map((function(e,n){return r.a.createElement(ce.a.Item,{key:e.id,eventKey:n,onSelect:b("user",e)},e.displayName)})):r.a.createElement("div",{className:c.noResults},"No results..."),r.a.createElement(ce.a.Item,{divider:!0}),r.a.createElement(ce.a.Item,{panel:!0,className:c.panelStyles},"Conversations"),m.search.conversations.length>0?m.search.conversations.map((function(e,n){return r.a.createElement(ce.a.Item,{key:e.id,eventKey:n,onSelect:b("conversation",e)},pe(e.members,!0))})):r.a.createElement("div",{className:c.noResults},"No results..."),r.a.createElement(ce.a.Item,{divider:!0}),r.a.createElement(ce.a.Item,{panel:!0,className:c.panelStyles},"Channels"),m.search.channels.length>0?m.search.channels.map((function(e,n){return r.a.createElement(ce.a.Item,{key:e.id,eventKey:n,onSelect:b("conversation",e)},"#",e.name)})):r.a.createElement("div",{className:c.noResults},"No results...")):r.a.createElement("div",null,"No results.")}),[b,c,m,d]);return r.a.createElement(se.a,{show:n,onHide:t},r.a.createElement(se.a.Header,null,r.a.createElement(se.a.Title,null,"Search")),r.a.createElement(se.a.Body,null,r.a.createElement(ge.a,{onChange:s,placeholder:"Enter text you want to search by..",className:c.input}),g),r.a.createElement(se.a.Footer,null,r.a.createElement(A.a,{onClick:t,appearance:"subtle"},"Close")))},xe={padding:"4px 20px",color:"#aaa"},Ie={fontSize:16,cursor:"pointer",color:"#2196f3",marginLeft:15},Be=r.a.memo((function(e){var n=e.users,t=e.conversations,c=e.refetch,o=e.channels,i=Object(a.useState)(!1),l=Object(v.a)(i,2),s=l[0],u=l[1],d=Object(a.useState)(!1),m=Object(v.a)(d,2),p=m[0],b=m[1],g=Object(a.useState)(!1),h=Object(v.a)(g,2),O=h[0],j=h[1],E=Object(a.useContext)(y),C=E.onLogout,k=E.user,S=be(),w=Object(f.g)(),N=Object(a.useCallback)((function(){u(!s)}),[s]),x=Object(a.useCallback)((function(){j(!O)}),[j,O]),I=Object(a.useCallback)((function(){b(!p)}),[p]);function B(e,n){return function(){w.push("/".concat(e,"/").concat(n.id))}}return r.a.createElement(r.a.Fragment,null,r.a.createElement(te.a,{className:S.container},r.a.createElement(ae.a,{appearance:"subtle"},r.a.createElement(ae.a.Header,null,r.a.createElement("div",{className:S.header},null===k||void 0===k?void 0:k.displayName,r.a.createElement(A.a,{color:"blue",onClick:C},"Logout"))),r.a.createElement(ae.a.Body,null,r.a.createElement(A.a,{style:{marginLeft:20},onClick:x},r.a.createElement(re.a,{icon:"search",style:{paddingRight:5}}),"Search"),(t.filter((function(e){return e.starred})).length>0||o.filter((function(e){return e.starred})))&&r.a.createElement(ce.a.Menu,{style:{background:"none"}},r.a.createElement(ce.a.Item,{panel:!0,style:xe},"Starred"),t.filter((function(e){return e.starred})).map((function(e,n){return r.a.createElement(ce.a.Item,{key:e.id,eventKey:n,onSelect:B("conversation",e)},pe(e.members,!0))})),o.filter((function(e){return e.starred})).map((function(e,n){return r.a.createElement(ce.a.Item,{key:e.id,eventKey:n,onSelect:B("conversation",e)},"#",e.name)})),r.a.createElement(ce.a.Item,{divider:!0})),r.a.createElement(ce.a.Menu,{style:{background:"none"}},r.a.createElement(ce.a.Item,{panel:!0,style:xe},"Direct Messages"),n.length>0?n.map((function(e,n){return r.a.createElement(ce.a.Item,{key:e.id,eventKey:n,onSelect:B("user",e)},e.displayName)})):r.a.createElement("div",{style:{padding:"5px 20px"}},"No results"),r.a.createElement(ce.a.Item,{divider:!0})),r.a.createElement(ce.a.Menu,{style:{background:"none"}},r.a.createElement(ce.a.Item,{panel:!0,style:xe},"Group conversations",r.a.createElement(re.a,{icon:"plus-circle",style:Ie,onClick:N})),t.filter((function(e){return!e.starred})).length>0?t.filter((function(e){return!e.starred})).map((function(e,n){return r.a.createElement(ce.a.Item,{key:e.id,eventKey:n,onSelect:B("conversation",e)},pe(e.members,!0))})):r.a.createElement("div",{style:{padding:"5px 20px"}},"No results"),r.a.createElement(ce.a.Item,{divider:!0})),r.a.createElement(ce.a.Menu,{style:{background:"none"}},r.a.createElement(ce.a.Item,{panel:!0,style:xe},"Channels",r.a.createElement(re.a,{icon:"plus-circle",style:Ie,onClick:I})),o.filter((function(e){return!e.starred})).length>0?o.filter((function(e){return!e.starred})).map((function(e,n){return r.a.createElement(ce.a.Item,{key:e.id,eventKey:n,onSelect:B("conversation",e)},"#",e.name)})):r.a.createElement("div",{style:{padding:"5px 20px"}},"No results"),r.a.createElement(ce.a.Item,{divider:!0}))))),r.a.createElement(Ne,{open:O,handleClose:x}),r.a.createElement(de,{open:s,handleClose:N,refetch:c,users:n}),r.a.createElement(ve,{open:p,handleClose:I,refetch:c,users:n}))})),Te=t(921),Le=t(920),Re=Object(F.a)({container:{background:X.LightGrey,height:"100%"},header:{height:60,padding:"20px 20px 15px",display:"flex",justifyContent:"space-between",alignItems:"center",background:X.White,borderBottom:1,borderBottomStyle:"solid",borderBottomColor:X.LighterGrey},content:{height:"calc(100% - 100px)",overflow:"auto"},footer:{padding:10,border:0,alignItems:"center"},yellow:{color:"#FFA500"},pointer:{cursor:"pointer"}});function Ue(){var e=Object(W.a)(["\n    query conversationMessages($id: String!) {\n        messages: conversationMessages(conversationId: $id) {\n            id\n            sender {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            content\n            createdAt\n            updatedAt\n            replyCount\n            imageUrl\n            type\n            pinned\n        }\n    }\n"]);return Ue=function(){return e},e}var $e=Object(P.a)(Ue());function Ae(){var e=Object(W.a)(["\n    query replies($id: String!) {\n        messages: replies(parentId: $id) {\n            id\n            sender {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            content\n            createdAt\n            updatedAt\n            replyCount\n            imageUrl\n            type\n            pinned\n        }\n    }\n"]);return Ae=function(){return e},e}var Fe=Object(P.a)(Ae()),qe=function(e){return"user"===e||"Private"===e?{query:Ce}:"Reply"===e?{query:Fe}:{query:$e}};function Me(){var e=Object(W.a)(["\n    mutation leaveConversation($id: String!) {\n        leaveConversation(id: $id) {\n            id\n            type\n            starred\n            createdAt\n        }\n    }\n"]);return Me=function(){return e},e}var We=Object(P.a)(Me());function Pe(){var e=Object(W.a)(["\n    mutation addMembers($members: [String!]!, $id: String!) {\n        addMembers(members: $members, id: $id) {\n            id\n            type\n            starred\n            createdAt\n            members {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n        }\n    }\n"]);return Pe=function(){return e},e}var Ge=Object(P.a)(Pe()),Qe=r.a.memo((function(e){var n=e.open,t=e.handleClose,c=e.users,o=e.refetch,i=e.id,l=Object(a.useState)([]),s=Object(v.a)(l,2),u=s[0],d=s[1],m=Object(a.useState)([]),p=Object(v.a)(m,2),b=p[0],g=p[1],f=Object(M.a)(Ge,{onCompleted:function(){o(),t()},onError:function(e){var n=e.graphQLErrors;d(n)}}),h=Object(v.a)(f,2),O=h[0],y=h[1].loading,j=Object(a.useCallback)(Object(le.a)(ie.a.mark((function e(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O({variables:{members:b,id:i}});case 2:g([]);case 3:case"end":return e.stop()}}),e)}))),[b,O,i]),E=Object(a.useCallback)((function(e){g(e)}),[]),C=c.map((function(e){return{label:e.displayName,value:e.id}}));return r.a.createElement(se.a,{show:n,onHide:t},r.a.createElement(se.a.Header,null,r.a.createElement(se.a.Title,null,"Create a new group")),r.a.createElement(se.a.Body,null,u.map((function(e,n){return r.a.createElement(R.a,{key:"error-".concat(n),showIcon:!0,type:"error",description:e.message})})),r.a.createElement(ue.a,{placeholder:"Add users to group / channel",data:C,onChange:E,value:b,style:{width:"100%"}})),r.a.createElement(se.a.Footer,null,r.a.createElement(A.a,{onClick:j,disabled:y,appearance:"primary"},"Ok"),r.a.createElement(A.a,{onClick:t,disabled:y,appearance:"subtle"},"Cancel")))})),ze=Object(F.a)({container:{display:"flex",margin:"10px 20px"},bold:{color:"#000",fontWeight:"bold"},avatar:{background:"#3498FF"},noBorderBottomRadius:{borderBottomLeftRadius:0,borderBottomRightRadius:0},withBorderBottomRadius:{borderBottomLeftRadius:4,borderBottomRightRadius:4},replyWrapper:{marginLeft:10,background:X.BackgroundGrey,borderTopWidth:1,borderTopColor:X.BorderGrey,borderTopStyle:"solid",padding:"5px 10px",fontSize:12},repliesCount:{color:X.Blue,cursor:"pointer",fontWeight:700,"&:hover":{textDecoration:"underline"}},messageWrapper:{width:"100%"},message:{background:X.White,padding:"5px 10px",fontSize:12,marginLeft:10,borderTopLeftRadius:4,borderTopRightRadius:4},content:{padding:"5px 0"},flex:{display:"flex"},alignCenter:{alignItems:"center"},date:{color:"#aaa",fontSize:10,marginLeft:10},moreIconBtn:{color:X.Grey,cursor:"pointer",marginLeft:"auto",paddingLeft:5,paddingRight:5,alignItems:"center",borderRadius:6,"&:hover":{backgroundColor:X.LightGrey}},image:{maxWidth:"100%"},thumbTack:{marginLeft:"auto",marginRight:10,cursor:"pointer"},pinned:{color:X.Blue},notPinned:{color:X.Grey}}),He=t(922),De=t(439),Je=t.n(De),Ke=t(39),Ye=Object(a.createContext)({isOpen:!1,selectedThread:null}),Ve=Object(a.createContext)({close:function(){},selectThread:function(){}}),Xe=function(e){var n=e.children,t=Object(a.useState)(!1),c=Object(v.a)(t,2),o=c[0],i=c[1],l=Object(a.useState)(null),s=Object(v.a)(l,2),u=s[0],d=s[1],m=Object(a.useCallback)((function(){d(null),i(!1)}),[i]),p=Object(a.useCallback)((function(e){d(e),i(!0)}),[d,i]),b=Object(a.useMemo)((function(){return{close:m,selectThread:p}}),[m,p]),g=Object(a.useMemo)((function(){return{isOpen:o,selectedThread:u}}),[o,u]);return r.a.createElement(Ve.Provider,{value:b},r.a.createElement(Ye.Provider,{value:g},n))},Ze=Object(F.a)({flex:{},inputWrapper:{display:"flex",background:X.White,border:4},input:{fontSize:13,padding:10,flex:1},border:{borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:X.BorderGrey},blueIcon:{color:X.Blue,width:30,marginTop:10,cursor:"pointer"},grey:{color:X.Grey},emojiSelect:{bottom:50}}),_e=(t(709),t(710),t(711),t(712),t(440)),en=t.n(_e),nn=t(441),tn=t.n(nn),an=t(35),rn=t(442),cn=t.n(rn),on=t(210),ln=t.n(on),sn=t(443),un=Object(F.a)({wrapper:{display:"flex",justifyContent:"flex-end",background:X.BackgroundGrey,borderTopWidth:1,borderTopColor:X.BorderGrey,borderTopStyle:"solid",padding:"5px 10px",fontSize:12}}),dn=t(448),mn=t(907),pn=Object(F.a)({textWrapper:{lineHeight:"200px"}}),bn=function(e){var n=e.selectedFile,t=e.handleChange,a=pn();return r.a.createElement(r.a.Fragment,null,r.a.createElement(mn.a,{disabled:!!n,autoUpload:!1,onChange:t,multiple:!1,listType:"picture-text",accept:"image/*",draggable:!0},r.a.createElement("div",{className:a.textWrapper},"Select image to upload")))},gn=function(e){var n=e.open,t=e.handleClose,c=e.handleSubmit,o=Object(a.useState)(null),i=Object(v.a)(o,2),l=i[0],s=i[1],u=Object(a.useCallback)((function(e){0!==e.length?s(e[0].blobFile||null):s(null)}),[s]),d=Object(a.useCallback)((function(){c&&(c(null,l),s(null),t())}),[c,l,t]);return r.a.createElement(se.a,{show:n,onHide:t},r.a.createElement(se.a.Header,null,r.a.createElement(se.a.Title,null,"Upload image")),r.a.createElement(se.a.Body,null,r.a.createElement(bn,{handleChange:u,selectedFile:l})),r.a.createElement(se.a.Footer,null,r.a.createElement(A.a,{disabled:!l,onClick:d,appearance:"primary"},"Upload"),r.a.createElement(A.a,{onClick:t,appearance:"subtle"},"Cancel")))},fn=function(e){var n=e.handleSubmit,t=Object(a.useState)(!1),c=Object(v.a)(t,2),o=c[0],i=c[1],l=un(),s=Object(a.useCallback)((function(){i(!0)}),[i]),u=Object(a.useMemo)((function(){return r.a.createElement(re.a,{icon:"attachment",onClick:s})}),[s]),d=Object(a.useCallback)((function(){i(!1)}),[i]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:l.wrapper},r.a.createElement(dn.a,{icon:u})),r.a.createElement(gn,{open:o,handleSubmit:n,handleClose:d}))},hn=function(e){var n=e.decoratorRect.left,t=window.innerWidth;return{left:(t-n>250?n:t-250)+"px",top:e.decoratorRect.top-40+"px",display:"block",transform:"scale(1) translateY(-100%)",transformOrigin:"1em 0% 0px",transition:"all 0.25s cubic-bezier(0.3, 1.2, 0.2, 1)"}},vn=function(e){var n,t=e.handleSubmit,c=e.readOnly,o=e.html,i=e.users,l=e.channels,s=e.isEditing,u=e.handleCancelEdit,d=Object(f.g)(),m=Ze(),p=Object(a.useMemo)((function(){return i.map((function(e){return{id:e.id,name:e.displayName}}))}),[i]),b=Object(a.useState)(p),g=Object(v.a)(b,2),h=g[0],O=g[1],y=Object(a.useState)(o?an.EditorState.createWithContent(Object(an.convertFromRaw)(JSON.parse(o))):an.EditorState.createEmpty()),j=Object(v.a)(y,2),E=j[0],C=j[1],w=Object(a.useCallback)((function(e){C(e)}),[C]),N=Object(a.useCallback)((function(){if(t&&E.getCurrentContent().hasText()){var e=JSON.stringify(Object(an.convertToRaw)(E.getCurrentContent()));t(e,null);var n=Object(sn.clearEditorContent)(E);w(n)}}),[w,E,t]),x=Object(a.useMemo)((function(){var e=tn()({positionSuggestions:hn});return{emojiPlugin:e,EmojiSuggestions:e.EmojiSuggestions}}),[]),I=Object(a.useCallback)((function(e){return function(){c&&i.find((function(n){return n.id===e}))&&d.push("/user/"+e)}}),[d,i,c]),B=Object(a.useCallback)((function(e){var n={};return c||Object.assign(n,{cursor:"default"}),r.a.createElement("span",{style:n,className:e.className,onClick:I(e.mention.id)},e.children)}),[c,I]),T=Object(a.useMemo)((function(){var e=ln()({positionSuggestions:hn,mentionComponent:B});return{mentionPlugin:e,MentionSuggestions:e.MentionSuggestions}}),[B]),L=Object(a.useCallback)((function(e){return function(){var n=l.find((function(n){return"#".concat(n.name)===e}));n&&d.push("/conversation/"+n.id)}}),[l,d]),R=Object(a.useCallback)((function(e){return function(n){var t=Object(S.a)({},n);return c&&Object.assign(t,{onClick:L(n.decoratedText),style:{cursor:"pointer"}}),e(t)}}),[L,c]),U=Object(a.useMemo)((function(){var e=cn()(),n=e.decorators[0].component;return e.decorators[0].component=R(n),{hashTagPlugin:e}}),[R]),$=Object(a.useCallback)((function(e){var n=e.value;O(Object(on.defaultSuggestionsFilter)(n,p))}),[p,O]),A=Object(a.useCallback)((function(){u&&u()}),[u]),F=Object(a.useMemo)((function(){return!c||s}),[c,s]);return r.a.createElement("div",{className:m.flex},r.a.createElement("div",{className:m.inputWrapper},r.a.createElement("div",{className:Object(Ke.default)((n={},Object(k.a)(n,m.input,F),Object(k.a)(n,m.border,s),n))},r.a.createElement(en.a,{editorState:E,onChange:w,placeholder:"Enter your text here...",readOnly:!F,plugins:[x.emojiPlugin,T.mentionPlugin,U.hashTagPlugin]})),r.a.createElement(x.EmojiSuggestions,null),r.a.createElement(T.MentionSuggestions,{onSearchChange:$,onAddMention:function(){},suggestions:h}),F&&r.a.createElement(re.a,{icon:"arrow-right",size:"lg",className:m.blueIcon,onClick:N}),s&&r.a.createElement(re.a,{icon:"close",size:"lg",className:Object(Ke.default)(m.blueIcon,m.grey),onClick:A})),!c&&r.a.createElement(fn,{handleSubmit:t}))};function On(){var e=Object(W.a)(["\n    mutation deleteMessage($id: String!) {\n        deleteMessage(messageId: $id)\n    }\n"]);return On=function(){return e},e}var yn=Object(P.a)(On());function jn(){var e=Object(W.a)(["\n    mutation togglePinned($id: String!) {\n        togglePinned(id: $id) {\n            id\n            sender {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            type\n            content\n            imageUrl\n            createdAt\n            updatedAt\n            pinned\n            replyCount\n            parent\n        }\n    }\n"]);return jn=function(){return e},e}var En=Object(P.a)(jn()),Cn=function(e){var n,t,c=e.message,o=e.isThreadMessage,i=e.users,l=e.conversations,s=e.channels,u=Object(a.useState)(!1),d=Object(v.a)(u,2),m=d[0],p=d[1],b=Object(a.useState)(!1),g=Object(v.a)(b,2),O=g[0],j=g[1],E=Object(a.useState)(!1),C=Object(v.a)(E,2),w=C[0],N=C[1],x=Object(f.h)(),I=Object(a.useContext)(y).user,B=Object(a.useContext)(Ve).selectThread,T=c.id,L=c.sender,R=c.content,U=c.updatedAt,$=ze(),A=Je()(L.id+L.email+L.displayName),F=A.isLight?X.Black:X.White,q=new Date(U).toLocaleString(),W=Object(M.a)(yn,{update:function(e,n){n.data.deleteMessage;var t=e.readQuery({query:qe(c.type).query,variables:{id:x.params.id}}).messages.filter((function(e){return e.id!==T}));e.writeQuery({query:qe(c.type).query,variables:{id:x.params.id},data:{messages:t}})}}),P=Object(v.a)(W,1)[0],G=Object(M.a)(En,{update:function(e,n){var t=n.data.togglePinned,a=e.readQuery({query:qe(c.type).query,variables:{id:x.params.id}}).messages.map((function(e){if(e.id===t.id)return Object(S.a)({},e,{pinned:t.pinned})}));e.writeQuery({query:qe(c.type).query,variables:{id:x.params.id},data:{messages:a}})}}),Q=Object(v.a)(G,1)[0],z=Object(a.useCallback)(Object(le.a)(ie.a.mark((function e(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q({variables:{id:c.id}});case 2:case"end":return e.stop()}}),e)}))),[c,Q]),H=Object(M.a)(J,{update:function(e,n){var t=n.data.sendMessage,a=e.readQuery({query:qe(c.type).query,variables:{id:x.params.id}});e.writeQuery({query:qe(c.type).query,variables:{id:x.params.id},data:{messages:a.messages.map((function(e){return e.id===c.id?t:e}))}}),p(!1),j(!1)}}),D=Object(v.a)(H,1)[0],K=Object(a.useCallback)(function(){var e=Object(le.a)(ie.a.mark((function e(n,t){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.next=3,D({variables:{data:{id:c.id,content:n,type:c.type,targetId:x.params.id}}});case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[x.params.id,c,D]),Y=Object(a.useCallback)((function(e){N(e)}),[N]),V=Object(a.useCallback)((function(){B(c)}),[c,B]),Z=Object(a.useCallback)(Object(le.a)(ie.a.mark((function e(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N(!1),e.next=3,P({variables:{id:T}});case 3:case"end":return e.stop()}}),e)}))),[T,P,N]),_=Object(a.useCallback)((function(){N(!1),j(!0)}),[N,j]),ee=Object(a.useCallback)((function(){j(!1)}),[j]),ne=Object(a.useCallback)((function(){return r.a.createElement(re.a,{className:$.moreIconBtn,icon:"more",size:"2x"})}),[$]),te=c.replyCount>0&&!o,ae=c.sender.id===(null===I||void 0===I?void 0:I.id);return r.a.createElement("div",{className:$.container},r.a.createElement(He.a,{className:$.avatar,style:{background:A.color,color:F}},L.displayName[0]),r.a.createElement("div",{className:$.messageWrapper},r.a.createElement("div",{className:Object(Ke.default)((n={},Object(k.a)(n,$.message,!0),Object(k.a)(n,$.noBorderBottomRadius,te),Object(k.a)(n,$.withBorderBottomRadius,!te),n))},r.a.createElement("div",{className:Object(Ke.default)($.bold,$.flex,$.alignCenter)},r.a.createElement("span",null,L.displayName),r.a.createElement("span",{className:$.date},q),r.a.createElement(re.a,{icon:"thumb-tack",onClick:z,className:Object(Ke.default)((t={},Object(k.a)(t,$.thumbTack,!0),Object(k.a)(t,$.pinned,c.pinned),Object(k.a)(t,$.notPinned,!c.pinned),t))}),r.a.createElement(ce.a,{placement:"bottomEnd",renderTitle:ne,open:w,onToggle:Y},r.a.createElement(ce.a.Item,{onSelect:V},"Reply"),ae&&r.a.createElement(r.a.Fragment,null,r.a.createElement(ce.a.Item,{onSelect:Z},"Delete"),r.a.createElement(ce.a.Item,{onSelect:_},"Edit")))),m?r.a.createElement(h.a,null):r.a.createElement("div",{className:$.content},R?r.a.createElement(vn,{users:i,conversations:l,channels:s,html:R,readOnly:!0,isEditing:O,handleCancelEdit:ee,handleSubmit:K}):r.a.createElement("img",{src:c.imageUrl,className:$.image}))),te&&r.a.createElement("div",{className:Object(Ke.default)($.replyWrapper,$.withBorderBottomRadius)},r.a.createElement("span",{onClick:V,className:$.repliesCount},c.replyCount," replies"))))},kn=Object(F.a)({info:{textAlign:"center",fontSize:18,marginTop:40}}),Sn=r.a.memo((function(e){var n=e.messages,t=e.isThread,a=e.users,c=e.conversations,o=e.channels,i=kn();return r.a.createElement(r.a.Fragment,null,n.length>0?n.map((function(e,n){return r.a.createElement(Cn,{users:a,conversations:c,channels:o,key:e.id+e.updatedAt,message:e,isThreadMessage:t})})):r.a.createElement("div",{className:i.info},"There are no messages in this conversation. Write a message to begin conversation."))})),wn=r.a.memo((function(e){var n=e.open,t=e.handleConfirm,a=e.handleClose;return r.a.createElement(se.a,{show:n,onHide:a},r.a.createElement(se.a.Header,null,r.a.createElement(se.a.Title,null,"Leave conversation")),r.a.createElement(se.a.Body,null,r.a.createElement("p",null,"Do you really want to leave this conversation?")),r.a.createElement(se.a.Footer,null,r.a.createElement(A.a,{onClick:t,appearance:"primary"},"Yes"),r.a.createElement(A.a,{onClick:a,color:"red"},"No")))})),Nn=r.a.memo((function(e){var n=e.activeChat,t=e.users,c=e.conversations,o=e.activeChatType,i=e.channels,l=e.refetch,s=Object(a.useState)(!1),u=Object(v.a)(s,2),d=u[0],m=u[1],p=Object(a.useState)(!1),b=Object(v.a)(p,2),g=b[0],O=b[1],y=Re(),j=Object(a.useRef)(null),E=t.find((function(e){return e.id===n})),C=Object(f.g)(),N=c.find((function(e){return e.id===n}))||i.find((function(e){return e.id===n})),x=Object(Oe.a)(qe(o).query,{variables:{id:n},skip:!n}),I=x.loading,B=x.data,T=x.error,L=Object(M.a)(J,{update:function(e,t){var a=t.data.sendMessage,r=e.readQuery({query:qe(o).query,variables:{id:n}});e.writeQuery({query:qe(o).query,variables:{id:n},data:{messages:r.messages.concat(a)}})}}),R=Object(v.a)(L,1)[0],U=Object(M.a)(We,{onCompleted:function(){l()}}),$=Object(v.a)(U,1)[0],F=Object(M.a)(Z,{update:function(e,n){var t=n.data.toggleStar,a=e.readQuery({query:je});e.writeQuery({query:je,data:{conversations:a.conversations.map((function(e){return Object(S.a)({},e,{starred:e.id===t.id?t.starred:e.starred})})),channels:a.channels.map((function(e){return Object(S.a)({},e,{starred:e.id===t.id?t.starred:e.starred})}))}})}}),q=Object(v.a)(F,1)[0],W=Object(a.useCallback)((function(){j.current&&j.current.scrollTo(0,j.current.scrollHeight)}),[]),P=Object(a.useCallback)((function(){m(!d)}),[m,d]),G=Object(a.useCallback)(function(){var e=Object(le.a)(ie.a.mark((function e(t,a){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(a),"user"!==o){e.next=4;break}return e.next=4,R({variables:{data:{content:t,type:"Private",targetId:n},image:a}});case 4:if("conversation"!==o){e.next=7;break}return e.next=7,R({variables:{data:{content:t,type:"Conversation",targetId:n},image:a}});case 7:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[R,n,o]),Q=Object(a.useCallback)((function(){O(!1)}),[O]),z=Object(a.useCallback)((function(){O(!0)}),[O]),H=Object(a.useCallback)(Object(le.a)(ie.a.mark((function e(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C.push("/"),e.next=3,$({variables:{id:N.id}});case 3:case"end":return e.stop()}}),e)}))),[C,N,$]),D=Object(a.useCallback)(Object(le.a)(ie.a.mark((function e(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(!1),e.next=3,H();case 3:case"end":return e.stop()}}),e)}))),[H,O]),K=Object(a.useCallback)((function(){if("conversation"===o&&N)return r.a.createElement(A.a,{onClick:z},"Leave")}),[H,N,o,z]),Y=Object(a.useCallback)((function(){if("conversation"===o&&N)return r.a.createElement(A.a,{onClick:P},"Add members")}),[P,N,o]),V=Object(a.useCallback)((function(){return"user"===o?E?"".concat(E.displayName):"None selected":"conversation"===o?(null===N||void 0===N?void 0:N.name)?"#"+(null===N||void 0===N?void 0:N.name):N?"".concat(pe(N.members)):"None selected":"None selected"}),[o,E,N]),X=Object(a.useCallback)(Object(le.a)(ie.a.mark((function e(){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q({variables:{id:N.id}});case 2:case"end":return e.stop()}}),e)}))),[q,N]),_=Object(a.useCallback)((function(){var e;if("conversation"===o&&N)return r.a.createElement(re.a,{icon:N.starred?"star":"star-o",onClick:X,style:{marginLeft:10},className:Object(Ke.default)((e={},Object(k.a)(e,y.pointer,!0),Object(k.a)(e,y.yellow,N.starred),e))})}),[X,y,o,N]);return Object(a.useEffect)((function(){W()}),[W]),I?r.a.createElement(h.a,{vertical:!0,center:!0,content:"Loading..."}):T&&n?r.a.createElement("div",null,"Something went wrong..."):r.a.createElement(w.a,{className:y.container},r.a.createElement(Te.a,{className:y.header},r.a.createElement("h5",null,V()," ",K()," ",Y(),_())),r.a.createElement("div",{className:y.content,ref:j},B&&B.messages&&r.a.createElement(Sn,{users:t,conversations:c,channels:i,messages:B.messages,isThread:!1})),r.a.createElement(Le.a,{className:y.footer},r.a.createElement(vn,{users:t,conversations:c,channels:i,handleSubmit:G})),r.a.createElement(Qe,{id:null===N||void 0===N?void 0:N.id,open:d,handleClose:P,refetch:l,users:t}),r.a.createElement(wn,{open:g,handleConfirm:D,handleClose:Q}))})),xn=t(421),In=t(415),Bn=t(416);function Tn(){var e=Object(W.a)(["\n    subscription subscribe {\n        subscribe {\n            event\n            payload {\n                chatId\n                message {\n                    id\n                    sender {\n                        id\n                        email\n                        displayName\n                        phoneNumber\n                        description\n                        imageUrl\n                    }\n                    content\n                    createdAt\n                    updatedAt\n                    replyCount\n                    imageUrl\n                    type\n                }\n            }\n        }\n    }\n"]);return Tn=function(){return e},e}var Ln=Object(P.a)(Tn()),Rn=Object(F.a)({container:{background:X.LightGrey,height:"100%",borderLeft:1,borderLeftStyle:"solid",borderColor:X.LighterGrey,WebkitTransition:"width .5s ease-in-out",MozTransition:"width .5s ease-in-out",OTransition:"width .5s ease-in-out",transition:"width .5s ease-in-out",overflow:"hidden"},open:{width:400},closed:{width:0},header:{height:60,padding:"20px 20px 15px",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:1,borderBottomStyle:"solid",borderBottomColor:X.LighterGrey,background:X.White},footer:{padding:10,border:0,alignItems:"center"}}),Un=t(913);function $n(){var e=Object(W.a)(["\n    mutation sendMessage($data: ReplyInput!, $image: Upload) {\n        sendReply(data: $data, image: $image) {\n            id\n            sender {\n                id\n                email\n                displayName\n                phoneNumber\n                description\n                imageUrl\n            }\n            content\n            createdAt\n            updatedAt\n            replyCount\n            imageUrl\n            type\n            pinned\n        }\n    }\n"]);return $n=function(){return e},e}var An=Object(P.a)($n()),Fn=r.a.memo((function(e){var n=e.users,t=e.conversations,c=e.channels,o=Object(a.useContext)(Ye),i=o.isOpen,l=o.selectedThread,s=Object(a.useContext)(Ve).close,u=Rn(),d=Object(Oe.a)(Fe,{variables:{id:null===l||void 0===l?void 0:l.id},skip:!l}),m=d.loading,p=d.data,b=d.error,g=Object(M.a)(An,{update:function(e,n){var t=n.data.sendReply,a=e.readQuery({query:Fe,variables:{id:null===l||void 0===l?void 0:l.id}});e.writeQuery({query:Fe,variables:{id:null===l||void 0===l?void 0:l.id},data:{messages:a.messages.concat(t)}})}}),f=Object(v.a)(g,1)[0],O=Object(a.useCallback)(function(){var e=Object(le.a)(ie.a.mark((function e(n,t){return ie.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=3;break}return e.next=3,f({variables:{data:{content:n,parentId:l.id},image:t}});case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),[f,l]);if(m)return r.a.createElement(h.a,{vertical:!0,center:!0,content:"Loading..."});if(b&&l)return r.a.createElement("div",null,"Something went wrong...");var y=i?u.open:u.closed;return r.a.createElement("div",{className:Object(Ke.default)(u.container,y)},r.a.createElement(Te.a,{className:u.header},r.a.createElement("h5",null,"Thread"),r.a.createElement(dn.a,{onClick:s,icon:r.a.createElement(re.a,{icon:"close"})})),l&&p&&r.a.createElement("div",null,r.a.createElement(Cn,{users:n,conversations:t,channels:c,message:l,isThreadMessage:!0}),r.a.createElement(Un.a,null),r.a.createElement(Sn,{users:n,conversations:t,channels:c,messages:p.messages,isThread:!0})),r.a.createElement(Le.a,{className:u.footer},r.a.createElement(vn,{users:n,conversations:t,channels:c,handleSubmit:O})))})),qn=Object(F.a)({container:{height:"100%"}}),Mn=function(){var e=Object(a.useState)(null),n=Object(v.a)(e,2),t=n[0],c=n[1],o=Object(a.useState)(null),i=Object(v.a)(o,2),l=i[0],s=i[1],u=Object(Oe.a)(je),d=u.loading,m=u.data,p=u.error,b=u.refetch,g=Object(xn.a)(Ln),O=Object(In.a)(),y=Object(f.h)(),j=qn();return Object(a.useEffect)((function(){var e;if(null===(e=g.data)||void 0===e?void 0:e.subscribe){var n,t=null===(n=g.data)||void 0===n?void 0:n.subscribe,a=t.payload,r=t.event;if(a.chatId&&a.message){var c=function(e,n){try{return e.readQuery(n)}catch(t){return null}}(O,{query:qe(r).query,variables:{id:a.chatId}});(null===c||void 0===c?void 0:c.messages)&&O.writeQuery({query:qe(r).query,variables:{id:a.chatId},data:{messages:c.messages.concat(a.message)}})}}}),[g.data,O,l]),Object(a.useEffect)((function(){c(y.params.id),s(y.params.type)}),[y.params.id,y.params.type]),d?r.a.createElement(h.a,{vertical:!0,center:!0,content:"Loading..."}):p?r.a.createElement(w.a,{style:{height:"100%"}},"Something went wrong!"):r.a.createElement(Bn.a,null,(function(e){return r.a.createElement(w.a,{className:j.container},r.a.createElement(Be,{users:m.users,conversations:m.conversations,channels:m.channels,refetch:b}),r.a.createElement(Nn,{users:m.users,conversations:m.conversations,channels:m.channels,activeChat:t,activeChatType:l,client:e,refetch:b}),r.a.createElement(Fn,{users:m.users,conversations:m.conversations,channels:m.channels}))}))},Wn=function(){return r.a.createElement(C.a,{basename:"/stud-18"},r.a.createElement(f.d,null,r.a.createElement(f.b,{path:"/register"},r.a.createElement(_,null)),r.a.createElement(f.b,{exact:!0,path:"/login"},r.a.createElement(ne,null)),r.a.createElement(E,{path:"/:type?/:id?"},r.a.createElement(Mn,null))))},Pn=t(445),Gn=(t(889),t(890),t(446)),Qn=new Pn.a(O),zn=Object(Gn.createUploadLink)({uri:"http://dc-itc.el.vgtu.lt:22080/stud-18-backend/graphql"}),Hn=Object(s.a)((function(e){var n=e.query,t=Object(g.a)(n);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),Qn,zn),Dn=new u.a((function(e,n){var t=localStorage.getItem("current-user");return t&&(t=JSON.parse(t),e.setContext({headers:{authorization:t.token}})),n(e)})),Jn=new d.a({cache:new m.a,link:Object(p.a)(Dn,Hn)});function Kn(){return r.a.createElement(b.a,{client:Jn},r.a.createElement(j,null,r.a.createElement(Xe,null,r.a.createElement(Wn,null))))}o.a.render(r.a.createElement(Kn,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/stud-18",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var n="".concat("/stud-18","/service-worker.js");i?(!function(e,n){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(t){var a=t.headers.get("content-type");404===t.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):l(e,n)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(n,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):l(n,e)}))}}()}},[[452,1,2]]]);
//# sourceMappingURL=main.b3a331ac.chunk.js.map